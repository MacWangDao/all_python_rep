"use strict";(self["webpackChunktrade_system"]=self["webpackChunktrade_system"]||[]).push([[573],{1573:function(t,e,a){a.r(e),a.d(e,{default:function(){return y}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page flex-row"},[e("div",{staticClass:"tree-container"},[e("div",{ref:"tlayout",staticClass:"tree-layout"},[e("el-tree",{ref:"mytree",attrs:{data:t.treeData,"node-key":"id","default-expand-all":"","filter-node-method":t.filterNode},on:{"node-click":t.handleLeftClick,"node-contextmenu":t.handleRightClick},scopedSlots:t._u([{key:"default",fn:function({node:a,data:s}){return e("span",{staticClass:"slot-t-node flex-row justify-between",on:{dblclick:function(e){return t.editNode(s)}}},[e("div",{directives:[{name:"show",rawName:"v-show",value:!s.isEdit,expression:"!data.isEdit"}]},[e("span",[t._v(t._s(a.label))])]),e("div",{directives:[{name:"show",rawName:"v-show",value:s.isEdit,expression:"data.isEdit"}]},[e("el-input",{ref:"slotTreeInput"+s.id,staticClass:"slot-t-input",attrs:{size:"mini",autofocus:""},on:{blur:function(e){return e.stopPropagation(),t.nodeBlur(a,s)}},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.nodeBlur(a,s)}},model:{value:s.label,callback:function(e){t.$set(s,"label",e)},expression:"data.label"}})],1),e("div",{staticClass:"flex-row icons"},[e("i",{staticClass:"icon-delete",on:{click:function(e){return e.stopPropagation(),t.deleteNode(s)}}})])])}}])})],1),e("div",{staticClass:"bottom-buttons"},[e("el-button",{staticClass:"new-combine-button",attrs:{disabled:t.isEditing},on:{click:function(e){return e.stopPropagation(),t.addSameLevelNode()}}},[t._v("新增策略")])],1)]),e("div",{staticClass:"content flex-col"},[e("div",{staticClass:"cardlist"},[e("Card",{scopedSlots:t._u([{key:"header",fn:function(){return[e("el-radio",{attrs:{label:2},model:{value:t.strategyType,callback:function(e){t.strategyType=e},expression:"strategyType"}},[t._v("POV")]),e("span",{staticClass:"header-text"},[t._v("成交量优先（POV）")])]},proxy:!0}])},[e("div",{staticClass:"card-content flex-row"},[e("div",{staticClass:"left flex-col justify-start"},[e("div",{staticClass:"row"},[e("span",[t._v("成交速率：")]),e("el-input",{model:{value:t.pov.rate,callback:function(e){t.$set(t.pov,"rate",e)},expression:"pov.rate"}}),e("span",{staticClass:"unit"},[t._v("%")])],1),e("div",{staticClass:"row"},[e("span",[t._v("步长：")]),e("el-input",{model:{value:t.pov.step,callback:function(e){t.$set(t.pov,"step",e)},expression:"pov.step"}}),e("span",{staticClass:"unit"},[t._v("ms")])],1),e("div",{staticClass:"row"},[e("span",[t._v("撤单时间：")]),e("el-input",{model:{value:t.pov.cancelOrderTime,callback:function(e){t.$set(t.pov,"cancelOrderTime",e)},expression:"pov.cancelOrderTime"}}),e("span",{staticClass:"unit"},[t._v("ms")])],1)]),e("div",{staticClass:"right flex-col justify-start"},[e("el-radio",{attrs:{label:0},model:{value:t.pov.limit,callback:function(e){t.$set(t.pov,"limit",e)},expression:"pov.limit"}},[t._v("本账户交易量不计入")]),e("el-radio",{attrs:{label:1},model:{value:t.pov.limit,callback:function(e){t.$set(t.pov,"limit",e)},expression:"pov.limit"}},[t._v("本账户交易量计入")])],1)])]),e("Card",{scopedSlots:t._u([{key:"header",fn:function(){return[e("el-radio",{attrs:{label:1},model:{value:t.strategyType,callback:function(e){t.strategyType=e},expression:"strategyType"}},[t._v("TWAP")]),e("span",{staticClass:"header-text"},[t._v("成交时间优先（TWAP）")])]},proxy:!0}])},[e("div",{staticClass:"card-content flex-row"},[e("div",{staticClass:"left flex-col justify-start"},[e("div",{staticClass:"row"},[e("span",[t._v("周长：")]),e("el-input",{model:{value:t.twap.cycle,callback:function(e){t.$set(t.twap,"cycle",e)},expression:"twap.cycle"}}),e("span",{staticClass:"unit"},[t._v("ms")])],1),e("div",{staticClass:"row"},[e("span",[t._v("步长：")]),e("el-input",{model:{value:t.twap.step,callback:function(e){t.$set(t.twap,"step",e)},expression:"twap.step"}}),e("span",{staticClass:"unit"},[t._v("ms")])],1),e("div",{staticClass:"row"},[e("span",[t._v("撤单时间：")]),e("el-input",{model:{value:t.twap.cancelOrderTime,callback:function(e){t.$set(t.twap,"cancelOrderTime",e)},expression:"twap.cancelOrderTime"}}),e("span",{staticClass:"unit"},[t._v("ms")])],1),e("div",{staticClass:"row"},[e("span",[t._v("扰动参数：")]),e("el-input",{model:{value:t.twap.disturbance,callback:function(e){t.$set(t.twap,"disturbance",e)},expression:"twap.disturbance"}})],1)]),e("div",{staticClass:"right flex-col justify-start"},[e("el-checkbox",{attrs:{label:"支持扰动"},model:{value:t.twap.supportDisturbance,callback:function(e){t.$set(t.twap,"supportDisturbance",e)},expression:"twap.supportDisturbance"}}),e("el-checkbox",{attrs:{label:"自动计算扰动"},model:{value:t.twap.autoCalcDisturbance,callback:function(e){t.$set(t.twap,"autoCalcDisturbance",e)},expression:"twap.autoCalcDisturbance"}}),e("el-checkbox",{attrs:{label:"限制完成"},model:{value:t.twap.limitCompletion,callback:function(e){t.$set(t.twap,"limitCompletion",e)},expression:"twap.limitCompletion"}}),e("el-checkbox",{attrs:{label:"对手方最优价"},model:{value:t.twap.bestPriceOfcounterparty,callback:function(e){t.$set(t.twap,"bestPriceOfcounterparty",e)},expression:"twap.bestPriceOfcounterparty"}})],1)])])],1),e("div",[e("el-button",{on:{click:t.updateStrategyDetails}},[t._v("保存策略")])],1)])])},i=[],l=(a(7658),a(6956)),r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"card"},[e("div",{staticClass:"card-header flex-row"},[t._t("header"),e("el-button",{staticStyle:{float:"right"},on:{click:t.setShowBody}},[t._v("收起")])],2),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showBody,expression:"showBody"}],staticClass:"card-body"},[t._t("default")],2)])},n=[],o={name:"Card",data(){return{showBody:!0}},methods:{setShowBody(){this.showBody=!this.showBody}}},c=o,d=a(1001),p=(0,d.Z)(c,r,n,!1,null,null,null),u=p.exports,h={name:"StrategySettings",components:{Card:u},data(){return{currentData:"",currentNode:"",isEditing:!1,maxStraId:0,treeData:[],strategyId:1,strategyname:"",strategyType:1,pov:{rate:10,step:3e3,cancelOrderTime:3e3,limit:0},twap:{cycle:3e3,step:3e3,cancelOrderTime:3e3,disturbance:.4,supportDisturbance:!1,autoCalcDisturbance:!1,limitCompletion:!1,bestPriceOfcounterparty:!1}}},methods:{filterNode(t,e){return!t||-1!==e.label.indexOf(t)},handleRightClick(t,e,a,s){},handleLeftClick(t,e){this.currentData=t,this.getStraDetails(t.id)},addSameLevelNode(){this.isEditing=!0;let t=this.treeData.length+1,e=this.newStraName(t);this.createStrategy_(e).then((t=>{this.maxStraId<t.data.sid&&(this.maxStraId=t.data.sid);let a={id:t.data.sid,label:e,isEdit:!0};this.treeData.push(a);let s=this.$refs.tlayout;this.$nextTick((()=>{s.scrollTop=s.scrollHeight}))}))},deleteNode(t){this.$modal.confirm("确认是否删除选中项？").then((()=>{this.removeStrategy_(t.id).then((e=>{this.treeData.splice(this.treeData.indexOf(t),1),this.$message.success("删除成功")})).catch((t=>{}))})).catch((()=>{}))},editNode(t){this.currentData=t||this.currentData,this.currentData.isEdit||this.$set(this.currentData,"isEdit",!0),this.$nextTick((()=>{this.$refs["slotTreeInput"+this.currentData.id].focus()}))},nodeBlur(t,e){if(console.log(t,e),0===e.label.length)return this.$message.error("策略名不可为空！"),!1;e.isEdit&&this.updateStrategyName_(e.id,e.label).then((t=>{this.isEditing=!1,this.$set(e,"isEdit",!1)})).catch((t=>{console.log(t),this.$message.error("策略名称重复")})),this.$nextTick((()=>{this.$refs["slotTreeInput"+e.id].$refs.input.focus()}))},isExistName(t){var e=!1;let a=this.treeData;return a.forEach((a=>{a.label==t&&(e=!0)})),e},newStraName(t){let e="新增策略"+this.maxStraId+t;return this.isExistName(e)&&(t+=1,e=this.newStraName(t)),e},getStrategyList_(){this.treeData=[];(0,l.v$)().then((t=>{let e=t.data;e.forEach((t=>{this.maxStraId<t.sid&&(this.maxStraId=t.sid),this.treeData.push({id:t.sid,label:t.straname,isEdit:!1})}))}))},createStrategy_(t){return new Promise((function(e,a){(0,l.im)(t).then((t=>{e(t)})).catch((t=>{console.log(t),a(t)}))}))},updateStrategyName_(t,e){return new Promise((function(a,s){(0,l.nP)(t,e).then((t=>{console.log(t),a(t)})).catch((t=>{s(t)}))}))},removeStrategy_(t){return new Promise((function(e,a){(0,l._L)(t).then((t=>{e(t)})).catch((t=>{a(t)}))}))},getStraDetails(t){(0,l.mB)(t).then((t=>{this.strategyname=t.data.straname,this.strategyId=t.data.sid,this.strategyType=null==t.data.type?1:t.data.type,1==this.strategyType?(this.twap.cycle=null==t.data.period?3e3:t.data.period,this.twap.step=null==t.data.step?3e3:t.data.step,this.twap.cancelOrderTime=null==t.data.cancel?3e3:t.data.cancel,this.twap.disturbance=.4,this.twap.limitCompletion=null!=t.data.limit&&0!=t.data.limit):2==this.strategyType&&(this.pov.rate=null==t.data.period?10:t.data.period,this.pov.step=null==t.data.step?3e3:t.data.step,this.pov.cancelOrderTime=null==t.data.cancel?3e3:t.data.cancel,this.pov.limit=null==t.data.limit?0:t.data.limit)}))},updateStrategyDetails(){if(0==this.strategyname.length)return void this.$message.error("请选择需要更新的策略");let t=0,e=0,a=0,s=0;1==this.strategyType?(t=this.twap.cycle,e=this.twap.step,a=this.twap.cancelOrderTime,s=this.twap.limitCompletion):2==this.strategyType&&(t=this.pov.rate,e=this.pov.step,a=this.pov.cancelOrderTime,s=this.pov.limit);let i={straname:this.strategyname,type:this.strategyType,period:t,step:e,cancel:a,limit:s,status:1,sid:this.strategyId};(0,l.xE)(i).then((t=>{this.$message.success(t.message)})).catch((t=>{console.log("updateStrategyDetails",t)}))}},created(){this.getStrategyList_()}},m=h,v=(0,d.Z)(m,s,i,!1,null,"8bcd521e",null),y=v.exports}}]);